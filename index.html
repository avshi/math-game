<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>×”××¡×¤×¨×™× ×”××—×•×‘×¨×™×</title>

<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0; }
.wrap { max-width: 750px; margin: 0 auto; padding: 20px; }
.card { background:white; border-radius: 14px; padding: 20px; box-shadow: 0 4px 18px rgba(0,0,0,.08); }
h1 { margin: 0 0 10px; }

.instructions {
  background:#eef4ff;
  padding:15px;
  border-radius:12px;
  margin-bottom:20px;
  font-size:15px;
  line-height:1.6;
}

.timer {
  background:#0b1220;
  color:white;
  padding:10px;
  border-radius:12px;
  text-align:center;
  font-weight:bold;
  margin-bottom:15px;
}

.timer.warn { background:#8b0000; }

.groups { display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin-bottom:15px; }
.g { background:#fafafa; border:1px solid #eee; border-radius:12px; padding:12px; min-width:220px; text-align:center; }
.nums { font-size:22px; direction:ltr; }

.row { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px; }

input { font-size:18px; padding:8px; width:160px; text-align:center; border-radius:10px; border:1px solid #ccc; }
button { padding:8px 14px; font-size:15px; border-radius:10px; border:none; cursor:pointer; }
.primary { background:#1a73e8; color:white; }
.secondary { background:#eee; }

.msg { margin-top:15px; font-weight:bold; }
.ok { color:green; }
.bad { color:red; }

.proof {
  margin-top:10px;
  background:#0b1220;
  color:#e7eefc;
  padding:12px;
  border-radius:12px;
  font-family:monospace;
  direction:ltr;
  white-space:pre-wrap;
}
</style>
</head>

<body>
<div class="wrap">
<div class="card">

<h1>ğŸ® ×”××¡×¤×¨×™× ×”××—×•×‘×¨×™×</h1>

<div class="instructions">
<b>××” ×¢×•×©×™×?</b><br>
×™×© 2 ×§×‘×•×¦×•×ª ×©×œ 3 ×¡×¤×¨×•×ª.<br>
×”××˜×¨×”: ×œ××¦×•× <b>××¡×¤×¨ ×©×œ× ×—×™×•×‘×™</b> ×©××¤×©×¨ ×œ×”×’×™×¢ ××œ×™×• ×‘×©×ª×™ ×”×§×‘×•×¦×•×ª,
×‘×¢×–×¨×ª ×¤×¢×•×œ×•×ª <b>+ - Ã— Ã·</b> ×‘×œ×‘×“,
×•×ª×•×š ×©×™××•×© <b>×‘×›×œ ×”×¡×¤×¨×•×ª ×¤×¢× ××—×ª ×‘×œ×‘×“</b>.<br><br>

<b>×“×•×’××”:</b><br>
×§×‘×•×¦×” 1: [6, 3, 2] â†’ (6 âˆ’ 3) Ã· 2 = 1<br>
×§×‘×•×¦×” 2: [9, 4, 5] â†’ (9 âˆ’ 5) Ã· 4 = 1<br>
×œ×›×Ÿ ×”×ª×•×¦××” ×”××©×•×ª×¤×ª ×”×™× <b>1</b>.
</div>

<div class="timer" id="timerBox">Time: 30s</div>

<div class="groups">
  <div class="g">
    <div>×§×‘×•×¦×” 1</div>
    <div class="nums" id="g1"></div>
  </div>
  <div class="g">
    <div>×§×‘×•×¦×” 2</div>
    <div class="nums" id="g2"></div>
  </div>
</div>

<div class="row">
  <input id="target" placeholder="××¡×¤×¨ ×©×œ× ×—×™×•×‘×™ ×‘×œ×‘×“">
  <button class="primary" onclick="checkTarget()">×‘×“×•×§</button>
  <button class="secondary" onclick="newPuzzle()">×ª×¨×’×™×œ ×—×“×©</button>
</div>

<div class="msg" id="msg"></div>
<div class="proof" id="proof" style="display:none;"></div>

</div>
</div>

<script>
const ROUND_SECONDS = 30;
let timeLeft = ROUND_SECONDS;
let timerId = null;
let roundActive = true;

function startTimer(){
  stopTimer();
  timeLeft = ROUND_SECONDS;
  roundActive = true;
  updateTimer();
  timerId = setInterval(()=>{
    timeLeft--;
    updateTimer();
    if(timeLeft<=0){
      stopTimer();
      roundActive=false;
      document.getElementById("msg").innerText="â° × ×’××¨ ×”×–××Ÿ!";
      document.getElementById("msg").className="msg bad";
    }
  },1000);
}

function stopTimer(){
  if(timerId){ clearInterval(timerId); timerId=null; }
}

function updateTimer(){
  const box=document.getElementById("timerBox");
  box.innerText="Time: "+timeLeft+"s";
  if(timeLeft<=5) box.classList.add("warn");
  else box.classList.remove("warn");
}

function gcd(a,b){ return b?gcd(b,a%b):a; }

function frac(n,d){
  if(d===0) return null;
  if(d<0){n=-n; d=-d;}
  let g=Math.abs(gcd(n,d));
  return {n:n/g,d:d/g};
}

function add(a,b){return frac(a.n*b.d+b.n*a.d,a.d*b.d);}
function sub(a,b){return frac(a.n*b.d-b.n*a.d,a.d*b.d);}
function mul(a,b){return frac(a.n*b.n,a.d*b.d);}
function div(a,b){if(b.n===0)return null; return frac(a.n*b.d,a.d*b.n);}

function perms(a){
  return [
    [a[0],a[1],a[2]],[a[0],a[2],a[1]],
    [a[1],a[0],a[2]],[a[1],a[2],a[0]],
    [a[2],a[0],a[1]],[a[2],a[1],a[0]]
  ];
}

const OPS=[
 {sym:"+",fn:add},
 {sym:"-",fn:sub},
 {sym:"*",fn:mul},
 {sym:"/",fn:div}
];

function getResults(nums){
  let map=new Map();
  for(let [x,y,z] of perms(nums)){
    let fx=frac(x,1), fy=frac(y,1), fz=frac(z,1);
    for(let o1 of OPS){
      for(let o2 of OPS){
        let r1=o1.fn(fx,fy);
        if(r1){
          let r=o2.fn(r1,fz);
          if(r && r.d===1 && r.n>0){
            let key=r.n;
            if(!map.has(key)){
              map.set(key,`(${x} ${o1.sym} ${y}) ${o2.sym} ${z}`);
            }
          }
        }
      }
    }
  }
  return map;
}

function randDigit(){ return Math.floor(Math.random()*9)+1; }

let group1, group2, map1, map2;

function newPuzzle(){
  let found=false;
  while(!found){
    group1=[randDigit(),randDigit(),randDigit()];
    group2=[randDigit(),randDigit(),randDigit()];
    map1=getResults(group1);
    map2=getResults(group2);
    let common=[...map1.keys()].filter(k=>map2.has(k));
    if(common.length>0) found=true;
  }

  document.getElementById("g1").innerText=group1.join(", ");
  document.getElementById("g2").innerText=group2.join(", ");
  document.getElementById("msg").innerText="";
  document.getElementById("proof").style.display="none";
  document.getElementById("target").value="";
  startTimer();
}

function checkTarget(){
  if(!roundActive) return;

  let val=parseInt(document.getElementById("target").value);
  if(!Number.isInteger(val) || val<=0){
    document.getElementById("msg").innerText="×”×›× ×¡ ××¡×¤×¨ ×©×œ× ×—×™×•×‘×™ ×‘×œ×‘×“";
    document.getElementById("msg").className="msg bad";
    return;
  }

  if(map1.has(val) && map2.has(val)){
    document.getElementById("msg").innerText="âœ… × ×›×•×Ÿ!";
    document.getElementById("msg").className="msg ok";
    document.getElementById("proof").style.display="block";
    document.getElementById("proof").innerText=
      `Group 1: ${map1.get(val)} = ${val}\n`+
      `Group 2: ${map2.get(val)} = ${val}`;
    roundActive=false;
    stopTimer();
  } else {
    document.getElementById("msg").innerText="âŒ ×œ× × ×›×•×Ÿ";
    document.getElementById("msg").className="msg bad";
  }
}

newPuzzle();
</script>
</body>
</html>
