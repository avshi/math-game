<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>×”××¡×¤×¨×™× ×”××—×•×‘×¨×™×</title>

<style>
  body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0; }
  .wrap { max-width: 760px; margin: 0 auto; padding: 20px; }
  .card { background:white; border-radius: 14px; padding: 20px; box-shadow: 0 4px 18px rgba(0,0,0,.08); }

  h1 { margin: 0 0 10px; }

  .instructions{
    background:#eef4ff;
    padding:15px;
    border-radius:12px;
    margin-bottom:14px;
    font-size:15px;
    line-height:1.6;
  }

  .topbar{ display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; }
  .timer{
    background:#0b1220; color:white; padding:10px 12px; border-radius:12px;
    text-align:center; font-weight:bold; min-width:140px; direction:ltr;
  }
  .timer.warn{ background:#8b0000; }

  .groups { display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin: 12px 0 14px; }
  .g { background:#fafafa; border:1px solid #eee; border-radius:12px; padding:12px; min-width:220px; text-align:center; }
  .nums { font-size:22px; direction:ltr; }

  .row { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px; }
  input { font-size:18px; padding:10px 12px; width:190px; text-align:center; border-radius:10px; border:1px solid #ccc; }
  button { padding:10px 14px; font-size:15px; border-radius:10px; border:none; cursor:pointer; }
  .primary { background:#1a73e8; color:white; }
  .secondary { background:#eee; }
  .warnBtn { background:#ffefc7; }

  .msg { margin-top:15px; font-weight:bold; font-size:18px; }
  .ok { color:green; }
  .bad { color:red; }

  .proof {
    margin-top:10px;
    background:#0b1220;
    color:#e7eefc;
    padding:12px;
    border-radius:12px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    direction:ltr;
    white-space: pre-wrap;
    text-align:left;
  }

  details { margin-top: 10px; }
  .small { font-size: 14px; color:#444; margin-top: 8px; line-height:1.4; }
</style>
</head>

<body>
<div class="wrap">
  <div class="card">

    <div class="topbar">
      <h1>ğŸ® ×”××¡×¤×¨×™× ×”××—×•×‘×¨×™×</h1>
      <div class="timer" id="timerBox">Time: 30s</div>
    </div>

    <div class="instructions">
      <b>××” ×¢×•×©×™×?</b><br>
      ×™×© 2 ×§×‘×•×¦×•×ª ×©×œ 3 ×¡×¤×¨×•×ª.<br>
      ×”××˜×¨×”: ×œ××¦×•× <b>××¡×¤×¨ ×©×œ× ×—×™×•×‘×™</b> ×©××¤×©×¨ ×œ×”×’×™×¢ ××œ×™×• ×‘×©×ª×™ ×”×§×‘×•×¦×•×ª,
      ×‘×¢×–×¨×ª ×¤×¢×•×œ×•×ª <b>+ - Ã— Ã·</b> ×‘×œ×‘×“,
      ×•×ª×•×š ×©×™××•×© <b>×‘×›×œ ×”×¡×¤×¨×•×ª ×¤×¢× ××—×ª ×‘×œ×‘×“</b>.<br><br>

      <b>×“×•×’××”:</b><br>
      ×§×‘×•×¦×” 1: [6, 3, 2] â†’ (6 âˆ’ 3) Ã· 2 = 1<br>
      ×§×‘×•×¦×” 2: [9, 4, 5] â†’ (9 âˆ’ 5) Ã· 4 = 1<br>
      ×œ×›×Ÿ ×”×ª×•×¦××” ×”××©×•×ª×¤×ª ×”×™× <b>1</b>.
    </div>

    <div class="groups">
      <div class="g">
        <div><b>×§×‘×•×¦×” 1</b></div>
        <div class="nums" id="g1"></div>
      </div>
      <div class="g">
        <div><b>×§×‘×•×¦×” 2</b></div>
        <div class="nums" id="g2"></div>
      </div>
    </div>

    <div class="row">
      <input id="target" inputmode="numeric" placeholder="××¡×¤×¨ ×©×œ× ×—×™×•×‘×™ ×‘×œ×‘×“">
      <button class="primary" onclick="checkTarget()">×‘×“×•×§</button>
      <button class="secondary" onclick="newPuzzle()">×ª×¨×’×™×œ ×—×“×©</button>
      <button class="warnBtn" onclick="toggleCommon()">×”×¦×’ ×ª×•×¦××•×ª ××©×•×ª×¤×•×ª</button>
    </div>

    <div class="msg" id="msg"></div>
    <div class="proof" id="proof" style="display:none;"></div>

    <details id="commonBox" style="display:none;">
      <summary>×ª×•×¦××•×ª ××©×•×ª×¤×•×ª ××¤×©×¨×™×•×ª (×©×œ××•×ª ×•×—×™×•×‘×™×•×ª)</summary>
      <div class="small" id="commonList"></div>
    </details>

    <div class="small">
      ×—×•×§×™×: ××©×ª××©×™× <b>×‘×›×œ ×”×¡×¤×¨×•×ª</b> ×¤×¢× ××—×ª ×‘×œ×‘×“, ×•×¨×§ ×‘×¤×¢×•×œ×•×ª <b>+ - * /</b> (××•×ª×¨ ×¡×•×’×¨×™×™×).<br/>
      ×ª×•×¦××” ××•×ª×¨×ª: <b>××¡×¤×¨ ×©×œ× ×—×™×•×‘×™ ×‘×œ×‘×“</b>.
    </div>

  </div>
</div>

<script>
  // =======================
  //  ×¦×œ×™×œ×™× ××¦×—×™×§×™× ğŸµ
  // =======================
  function playFunnySound(type) {
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    if (!AudioCtx) return;

    const ctx = new AudioCtx();

    function tone(freq, duration, wave = "sine", gainVal = 0.22) {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = wave;
      osc.frequency.value = freq;
      gain.gain.value = gainVal;
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start();
      setTimeout(() => osc.stop(), duration);
    }

    if (type === "success") {
      // BOING ×§×•×¤×¦× ×™
      tone(420, 90, "square");
      setTimeout(() => tone(720, 130, "square"), 90);
      setTimeout(() => tone(980, 180, "square"), 220);
    } else if (type === "fail") {
      // WAH-WAH ××¦×—×™×§
      tone(520, 160, "sawtooth");
      setTimeout(() => tone(320, 240, "sawtooth"), 160);
    } else if (type === "timeout") {
      // ×“×¨××˜×™ ×™×•×¨×“
      tone(650, 180, "triangle");
      setTimeout(() => tone(430, 200, "triangle"), 180);
      setTimeout(() => tone(220, 260, "triangle"), 380);
    }

    // ×¡×’×™×¨×ª ×”-context ××—×¨×™ ×¨×’×¢
    setTimeout(() => ctx.close(), 900);
  }

  // =======================
  //  ×˜×™×™××¨ â±ï¸
  // =======================
  const ROUND_SECONDS = 30;
  let timeLeft = ROUND_SECONDS;
  let timerId = null;
  let roundActive = true;

  function startTimer(){
    stopTimer();
    timeLeft = ROUND_SECONDS;
    roundActive = true;
    updateTimer();
    timerId = setInterval(()=>{
      timeLeft--;
      updateTimer();
      if(timeLeft <= 0){
        timeLeft = 0;
        updateTimer();
        stopTimer();
        roundActive = false;
        setMessage("â° × ×’××¨ ×”×–××Ÿ! ×œ×—×¥ '×ª×¨×’×™×œ ×—×“×©' ×›×“×™ ×œ× ×¡×•×ª ×©×•×‘.", false);
        document.getElementById("proof").style.display = "none";
        playFunnySound("timeout");
      }
    }, 1000);
  }

  function stopTimer(){
    if(timerId){
      clearInterval(timerId);
      timerId = null;
    }
  }

  function updateTimer(){
    const box = document.getElementById("timerBox");
    box.textContent = `Time: ${timeLeft}s`;
    box.classList.toggle("warn", timeLeft <= 5 && roundActive);
  }

  // =======================
  //  ×—×™×©×•×‘ ××“×•×™×§ ×‘×©×‘×¨×™× (×œ×œ× Floating Point)
  // =======================
  function gcd(a,b){ a=Math.abs(a); b=Math.abs(b); while(b){ [a,b]=[b,a%b]; } return a||1; }
  function frac(n,d){
    if(d === 0) return null;
    if(d < 0){ n = -n; d = -d; }
    const g = gcd(n,d);
    return { n: n/g, d: d/g };
  }
  function add(a,b){ return frac(a.n*b.d + b.n*a.d, a.d*b.d); }
  function sub(a,b){ return frac(a.n*b.d - b.n*a.d, a.d*b.d); }
  function mul(a,b){ return frac(a.n*b.n, a.d*b.d); }
  function div(a,b){ if(b.n === 0) return null; return frac(a.n*b.d, a.d*b.n); }
  function keyOf(f){ return `${f.n}/${f.d}`; }

  // ×¨×§ ××¡×¤×¨ ×©×œ× ×—×™×•×‘×™
  function parseTarget(){
    const s = (document.getElementById("target").value || "").trim();
    const v = Number(s);
    if(!Number.isFinite(v) || !Number.isInteger(v) || v <= 0) return null;
    return v;
  }

  function perms3(a){
    return [
      [a[0],a[1],a[2]],[a[0],a[2],a[1]],
      [a[1],a[0],a[2]],[a[1],a[2],a[0]],
      [a[2],a[0],a[1]],[a[2],a[1],a[0]]
    ];
  }

  const OPS = [
    {sym:"+", fn:add},
    {sym:"-", fn:sub},
    {sym:"*", fn:mul},
    {sym:"/", fn:div}
  ];

  // Map: intResult -> expression
  function getPositiveIntegerResultsWithProof(nums){
    const out = new Map();

    for(const [x,y,z] of perms3(nums)){
      const fx = frac(x,1), fy = frac(y,1), fz = frac(z,1);

      for(const o1 of OPS){
        for(const o2 of OPS){

          // (x o1 y) o2 z
          const r1 = o1.fn(fx, fy);
          if(r1){
            const r = o2.fn(r1, fz);
            if(r && r.d === 1 && r.n > 0 && !out.has(r.n)){
              out.set(r.n, `(${x} ${o1.sym} ${y}) ${o2.sym} ${z}`);
            }
          }

          // x o1 (y o2 z)
          const r2 = o2.fn(fy, fz);
          if(r2){
            const r = o1.fn(fx, r2);
            if(r && r.d === 1 && r.n > 0 && !out.has(r.n)){
              out.set(r.n, `${x} ${o1.sym} (${y} ${o2.sym} ${z})`);
            }
          }
        }
      }
    }
    return out;
  }

  function randDigit(){ return Math.floor(Math.random()*9)+1; }

  let group1 = [0,0,0];
  let group2 = [0,0,0];
  let map1 = new Map();
  let map2 = new Map();

  function setMessage(text, ok){
    const el = document.getElementById("msg");
    el.textContent = text;
    el.className = "msg " + (ok ? "ok" : "bad");
  }

  function newPuzzle(){
    let tries = 0;
    while(true){
      group1 = [randDigit(), randDigit(), randDigit()];
      group2 = [randDigit(), randDigit(), randDigit()];
      map1 = getPositiveIntegerResultsWithProof(group1);
      map2 = getPositiveIntegerResultsWithProof(group2);

      const common = [...map1.keys()].filter(k => map2.has(k));
      if(common.length > 0) {
        // update debug list
        common.sort((a,b)=>a-b);
        document.getElementById("commonList").textContent = common.join(", ");
        break;
      }

      tries++;
      if(tries > 800) break; // × ×“×™×¨, ××‘×œ ×©×œ× ×™×™×ª×§×¢
    }

    document.getElementById("g1").textContent = `[${group1.join(", ")}]`;
    document.getElementById("g2").textContent = `[${group2.join(", ")}]`;

    document.getElementById("target").value = "";
    document.getElementById("proof").style.display = "none";
    document.getElementById("proof").textContent = "";
    document.getElementById("msg").textContent = "";

    startTimer();
    document.getElementById("target").focus();
  }

  function checkTarget(){
    if(!roundActive){
      setMessage("×”×¡×™×‘×•×‘ × ×’××¨. ×œ×—×¥ '×ª×¨×’×™×œ ×—×“×©' ×›×“×™ ×œ×”×ª×—×™×œ ×©×•×‘.", false);
      return;
    }

    const t = parseTarget();
    if(t === null){
      setMessage("×”×›× ×¡ ××¡×¤×¨ ×©×œ× ×—×™×•×‘×™ ×‘×œ×‘×“ (×œ××©×œ 5).", false);
      playFunnySound("fail");
      document.getElementById("proof").style.display = "none";
      return;
    }

    if(map1.has(t) && map2.has(t)){
      setMessage("âœ… × ×›×•×Ÿ! ××¦××ª ×ª×•×¦××” ××©×•×ª×¤×ª.", true);
      playFunnySound("success");

      const proof = document.getElementById("proof");
      proof.style.display = "block";
      proof.textContent =
        `Group 1: ${map1.get(t)} = ${t}\n` +
        `Group 2: ${map2.get(t)} = ${t}`;

      roundActive = false;
      stopTimer();
      updateTimer();
    } else {
      setMessage("âŒ ×œ× × ×›×•×Ÿ. ×”×ª×•×¦××” ×”×–×• ×œ× ××¤×©×¨×™×ª ×‘×©×ª×™ ×”×§×‘×•×¦×•×ª.", false);
      playFunnySound("fail");
      document.getElementById("proof").style.display = "none";
    }
  }

  function toggleCommon(){
    const box = document.getElementById("commonBox");
    box.style.display = (box.style.display === "none") ? "block" : "none";
  }

  // Enter = ×‘×“×•×§
  document.addEventListener("keydown", (e) => {
    if (e.key === "Enter") checkTarget();
  });

  // start
  newPuzzle();
</script>
</body>
</html>
